# JS 中的数组模式

我们都知道 V8 是一个用 C++ 编写的 JS 引擎，那么 JS 的数组是使用 C/C++ 的数组存储的吗？实际上是不一定的，V8 使用两种模式来存储 JS 数组：

1. 快速模式：使用 C/C++ 的数组存储（存储单元连续，访问速度快，紧凑）
1. 字典模式：使用 C/C++ 的哈希表存储（存储单元松散，访问速度慢，松散）

触发机制：

1. 无论数组长度为多少，数组中不存在 empty，V8 使用快速模式存储数组
1. 无论数组中是否存在 empty，数组长度小于 100000，V8 使用快速模式存储数组
1. 数组长度大于等于 100000，且数组中存在 empty，V8 使用字典模式存储数组

我们更希望 V8 能用快速模式存储数组，可以做出以下优化策略：

+ 初始化数组时从 0 下标开始，避免出现数组中存在 empty 的情况
+ 不要盲目创建一个长度过长的数组，例如长度超过 100000 的数组
+ 尽量不要 delete 数组元素，可以将该元素设为 undefined