# V8 的隐藏类

<br>

JavaScript 是一门动态语言，可以在运行时可以动态地增删改属性，且属性的类型不固定，所以开发者往往觉得 js 的对象用起来很爽，没有拘束，但是这样的代价是什么？对象属性在内存中的存储位置不固定，只能通过遍历属性列表的方式访问（最坏情况达到 O(n) 复杂度）

那我们来参考一下其他的静态语言，例如 Java, C, C++ ..., 它们都是编译型语言，对象的属性类型和数量在编译时就已经确定下来，知道了对象的基地址以及该属性的类型（每个类型有固定的空间大小，即偏移量），通过计算基地址 + 偏移量的方式，能立即获取该属性的地址（O(1) 复杂度）

隐藏类（Hidden Class）就是 V8 引擎静态借鉴语言的特性对 js 对象属性或方法访问速度优化做出的努力，使得对 js 对象成员的访问性能接近静态语言

<br>

观察以下三个对象

```js
const obj1 = {
  x: 1,
  y: 2,
};

const obj2 = {
  x: 3,
  y: 4,
};

const obj3 = {
  y: 5,
  x: 6,
  z: 7,
};
```

obj1 和 obj2 的属性类型和属性顺序都相同，V8 会为它们生成一个共享的隐藏类；而 obj3 的属性顺序不同，且存在一个额外的属性 z，V8 会为 obj3 生成另一个隐藏类

那么知道了该特性，我们应该写怎样的代码才能对 V8 更“友好”：

+ 尽量按照同样的属性顺序构建对象（如使用同一个构造函数），使得同一系列隐藏类被重复利用
+ 尽量一次性初始化对象的所有属性，而不是创建完对象之后再动态增减属性，从而避免让 V8 创建多个隐藏类
